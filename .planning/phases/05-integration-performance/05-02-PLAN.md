---
phase: 05-integration-performance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .knowledge/integration/quality-gates.ts
  - .knowledge/integration/index.ts
  - .knowledge/extractor/pattern-identifier.ts
autonomous: true

must_haves:
  truths:
    - "Pattern validation returns quality score with detailed issues"
    - "Patterns below quality threshold are flagged (not auto-rejected)"
    - "Quality checks run on extraction before storage"
  artifacts:
    - path: ".knowledge/integration/quality-gates.ts"
      provides: "Quality validation functions"
      exports: ["validateQuality", "QualityResult", "QualityIssue"]
    - path: ".knowledge/integration/index.ts"
      provides: "Integration module barrel export"
  key_links:
    - from: ".knowledge/extractor/pattern-identifier.ts"
      to: ".knowledge/integration/quality-gates.ts"
      via: "imports validateQuality"
      pattern: "import.*validateQuality.*quality-gates"
---

<objective>
Implement quality validation gates for pattern storage.

Purpose: Requirements QUAL-01 and QUAL-02 specify validation gates to prevent degraded patterns and maintain quality baseline. This builds on existing Zod schema validation with additional completeness and coherence checks.

Output: A quality-gates module that scores patterns and reports issues, integrated into the extraction pipeline.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-integration-performance/05-RESEARCH.md
@.knowledge/schema/pattern.schema.ts
@.knowledge/extractor/pattern-identifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create quality gates module</name>
  <files>.knowledge/integration/quality-gates.ts</files>
  <action>
Create a new module at `.knowledge/integration/quality-gates.ts` that implements pattern quality validation:

```typescript
import type { Pattern } from '../schema/pattern.schema';

export type Severity = 'error' | 'warning' | 'info';

export interface QualityIssue {
  field: string;
  severity: Severity;
  message: string;
  suggestion?: string;
}

export interface QualityResult {
  level: 'passed' | 'warning' | 'failed';
  score: number;  // 0-100
  issues: QualityIssue[];
  summary: string;
}

export function validateQuality(pattern: Pattern): QualityResult {
  // Implementation
}
```

**Quality checks to implement:**

1. **Completeness checks (warning level):**
   - principles array has at least 3 items (quality patterns have substance)
   - tags array has at least 2 items (searchability)
   - If documentation exists, description is at least 50 chars
   - At least one code_example if frameworks specified

2. **Code example checks (warning level):**
   - Each code example is at least 100 characters (not a stub)
   - React examples contain JSX (check for `<` and `>`)
   - Vue examples contain template or setup (check for `template` or `setup`)

3. **Coherence checks (info level):**
   - Category matches at least one tag (e.g., 'forms' category has form-related tag)
   - Frameworks in code_examples match frameworks array

4. **Scoring:**
   - Start at 100
   - error: -30 points each
   - warning: -10 points each
   - info: -5 points each
   - level: passed (>=80), warning (>=60), failed (<60)

5. **Summary generation:**
   - Generate human-readable summary: "Pattern has X issues (Y warnings, Z info)"
  </action>
  <verify>
```bash
# File exists and exports expected types
grep -E "export (interface|type|function)" .knowledge/integration/quality-gates.ts
```
  </verify>
  <done>quality-gates.ts exists with validateQuality function and type exports</done>
</task>

<task type="auto">
  <name>Task 2: Create integration module barrel</name>
  <files>.knowledge/integration/index.ts</files>
  <action>
Create barrel export for the integration module:

```typescript
/**
 * Integration module for KUI Design skill.
 * Contains quality gates, context analysis, and workflow integration.
 */

// Re-export quality gate types and functions
export {
  validateQuality,
  type QualityResult,
  type QualityIssue,
  type Severity,
} from './quality-gates';
```

Also ensure the directory exists. The integration module will be expanded with context analysis and suggestion engine in subsequent plans.
  </action>
  <verify>
```bash
# Directory and file exist
ls -la .knowledge/integration/

# Exports are correct
grep -E "export.*validateQuality" .knowledge/integration/index.ts
```
  </verify>
  <done>integration/index.ts barrel file exports quality-gates module</done>
</task>

<task type="auto">
  <name>Task 3: Integrate quality validation into extraction</name>
  <files>.knowledge/extractor/pattern-identifier.ts</files>
  <action>
Add quality validation to the pattern extraction pipeline. Modify the validatePattern or identifyPatterns function to:

1. After successful Zod schema validation, run quality validation
2. Log quality issues but DO NOT block storage (allow user to decide)
3. Include quality score in the extraction result

Find the appropriate location in pattern-identifier.ts where patterns are validated/returned and add:

```typescript
import { validateQuality } from '../integration/quality-gates';

// After Zod validation succeeds:
const qualityResult = validateQuality(pattern);
if (qualityResult.level !== 'passed') {
  console.log(`Quality: ${qualityResult.level} (score: ${qualityResult.score})`);
  for (const issue of qualityResult.issues) {
    console.log(`  [${issue.severity}] ${issue.field}: ${issue.message}`);
  }
}
```

The goal is visibility, not blocking. Quality issues should be surfaced but not prevent storage. Manual curation (QUAL-02) comes from users reviewing these warnings.
  </action>
  <verify>
```bash
# Check import exists
grep "import.*validateQuality" .knowledge/extractor/pattern-identifier.ts

# Check quality validation is called
grep "validateQuality" .knowledge/extractor/pattern-identifier.ts | wc -l
```
  </verify>
  <done>Pattern extraction logs quality validation results during pattern identification</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors:
   ```bash
   npx tsc --noEmit .knowledge/integration/quality-gates.ts .knowledge/integration/index.ts
   ```

2. Quality validation produces expected output:
   ```bash
   npx tsx -e "
   import { validateQuality } from './.knowledge/integration/quality-gates';
   const result = validateQuality({
     name: 'Test Pattern',
     category: 'forms',
     tags: ['test'],  // Only 1 tag - should warn
     frameworks: ['react'],
     principles: ['One principle'],  // Only 1 - should warn
   });
   console.log(JSON.stringify(result, null, 2));
   "
   ```
   Should show warning level with issues about tags and principles count

3. Pattern identifier imports quality gates:
   ```bash
   grep -E "import.*quality" .knowledge/extractor/pattern-identifier.ts
   ```
</verification>

<success_criteria>
- [ ] quality-gates.ts implements validateQuality with scoring system
- [ ] QualityResult includes level, score, issues array, and summary
- [ ] Checks cover completeness (principles, tags) and code quality (example length)
- [ ] Integration barrel exports all quality gate types and functions
- [ ] Pattern extraction pipeline logs quality validation results
- [ ] Quality validation is advisory (warns but doesn't block)
</success_criteria>

<output>
After completion, create `.planning/phases/05-integration-performance/05-02-SUMMARY.md`
</output>
