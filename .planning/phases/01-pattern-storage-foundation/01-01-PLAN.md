---
phase: 01-pattern-storage-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .knowledge/schema/pattern.schema.ts
  - .knowledge/schema/categories.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Pattern schema validates all required fields (name, category, tags, frameworks, principles)"
    - "Category enum includes all 7 categories from requirements"
    - "TypeScript types are inferred from Zod schema"
  artifacts:
    - path: ".knowledge/schema/pattern.schema.ts"
      provides: "Zod schema for pattern validation"
      exports: ["PatternSchema", "Pattern"]
    - path: ".knowledge/schema/categories.ts"
      provides: "Category enum and type definitions"
      exports: ["CATEGORIES", "Category", "Framework"]
  key_links:
    - from: ".knowledge/schema/pattern.schema.ts"
      to: ".knowledge/schema/categories.ts"
      via: "import Category enum"
      pattern: "import.*categories"
---

<objective>
Create the Zod schema foundation for pattern validation and TypeScript types.

Purpose: STOR-01 and STOR-05 require validated YAML patterns with a defined structure. The schema becomes the single source of truth for pattern structure.
Output: Zod schema file with Pattern type, category definitions, and framework compatibility types.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-pattern-storage-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create directory structure</name>
  <files>package.json, .knowledge/schema/</files>
  <action>
    Initialize npm package if not exists (npm init -y), then install:
    - zod (schema validation)
    - yaml (YAML parsing)
    - glob (file discovery)

    Create directory structure:
    - .knowledge/schema/
    - .knowledge/patterns/layout/
    - .knowledge/patterns/forms/
    - .knowledge/patterns/navigation/
    - .knowledge/patterns/micro-interactions/
    - .knowledge/patterns/data-display/
    - .knowledge/patterns/feedback/
    - .knowledge/patterns/authentication/

    Add .gitkeep files to empty pattern directories.
  </action>
  <verify>
    - npm ls zod yaml glob (shows installed packages)
    - ls -la .knowledge/schema/ (directory exists)
    - ls .knowledge/patterns/ (shows 7 category folders)
  </verify>
  <done>Dependencies installed, directory structure created with all 7 category folders</done>
</task>

<task type="auto">
  <name>Task 2: Create category and framework type definitions</name>
  <files>.knowledge/schema/categories.ts</files>
  <action>
    Create TypeScript file with:

    1. CATEGORIES array with all 7 categories:
       - layout
       - forms
       - navigation
       - micro-interactions
       - data-display
       - feedback
       - authentication

    2. Category type derived from array (typeof CATEGORIES[number])

    3. FRAMEWORKS array:
       - react
       - vue
       - svelte
       - vanilla

    4. Framework type derived from array

    5. WCAG_LEVELS array: ['A', 'AA', 'AAA']

    Use const assertions for type safety.
  </action>
  <verify>
    - npx tsc --noEmit .knowledge/schema/categories.ts (no errors)
    - File exports CATEGORIES, Category, FRAMEWORKS, Framework, WCAG_LEVELS, WcagLevel
  </verify>
  <done>Category and framework type definitions created with proper TypeScript types</done>
</task>

<task type="auto">
  <name>Task 3: Create Zod pattern schema</name>
  <files>.knowledge/schema/pattern.schema.ts</files>
  <action>
    Create Zod schema matching the pattern structure from research:

    PatternSchema = z.object({
      name: z.string().min(3).max(100),
      category: z.enum(CATEGORIES),
      tags: z.array(z.string().min(1)).min(1),
      frameworks: z.array(z.enum(FRAMEWORKS)).min(1),
      accessibility: z.object({
        notes: z.string(),
        wcag_level: z.enum(WCAG_LEVELS).optional()
      }).optional(),
      principles: z.array(z.string()).min(1),
      code_examples: z.record(z.enum(FRAMEWORKS), z.string()).optional(),
      source: z.object({
        url: z.string().url().optional(),
        extracted: z.string().optional()
      }).optional()
    });

    Export:
    - PatternSchema (the Zod schema)
    - Pattern type (z.infer<typeof PatternSchema>)
    - PatternInput type (z.input<typeof PatternSchema>)
  </action>
  <verify>
    - npx tsc --noEmit .knowledge/schema/pattern.schema.ts (no TypeScript errors)
    - Create a quick test: parse a valid pattern object, verify no errors
  </verify>
  <done>Zod schema validates pattern structure, TypeScript types inferred correctly</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors:
   ```bash
   npx tsc --noEmit .knowledge/schema/*.ts
   ```

2. Schema validates a sample pattern:
   ```typescript
   import { PatternSchema } from '.knowledge/schema/pattern.schema';
   PatternSchema.parse({
     name: 'Test Pattern',
     category: 'layout',
     tags: ['test'],
     frameworks: ['react'],
     principles: ['Test principle']
   });
   ```

3. Invalid patterns are rejected (missing required fields throws ZodError)
</verification>

<success_criteria>
- zod, yaml, glob packages installed
- .knowledge/schema/ directory created
- .knowledge/patterns/{category}/ directories for all 7 categories
- categories.ts exports CATEGORIES, Category, FRAMEWORKS, Framework
- pattern.schema.ts exports PatternSchema, Pattern type
- TypeScript compilation succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-pattern-storage-foundation/01-01-SUMMARY.md`
</output>
