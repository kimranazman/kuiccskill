---
phase: 02-code-generation-engine
plan: 04
type: execute
wave: 2
depends_on: []
files_modified:
  - .knowledge/generator/output.ts
  - .knowledge/generator/index.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "displayCode() shows syntax-highlighted code in terminal with visible colors"
    - "copyToClipboard() successfully copies text and can be pasted elsewhere"
    - "outputCode() displays preview then copies to clipboard with confirmation message"
    - "Clipboard failure shows graceful fallback message without crashing"
  artifacts:
    - path: ".knowledge/generator/output.ts"
      provides: "Syntax highlighting and clipboard operations"
      exports: ["displayCode", "copyToClipboard", "outputCode"]
    - path: "package.json"
      provides: "New dependencies"
      contains: ["clipboardy", "cli-highlight", "chalk"]
  key_links:
    - from: ".knowledge/generator/output.ts"
      to: "clipboardy"
      via: "dynamic import for ESM"
      pattern: "import\\('clipboardy'\\)"
    - from: ".knowledge/generator/output.ts"
      to: "cli-highlight"
      via: "highlight function"
      pattern: "highlight\\("
---

<objective>
Create output module for syntax-highlighted terminal display and clipboard operations.

Purpose: GEN-07 requires clipboard copy with confirmation, GEN-08 requires syntax-highlighted preview. This module handles all output formatting and clipboard interaction.
Output: output.ts with displayCode(), copyToClipboard(), and combined outputCode() functions.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-code-generation-engine/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install output dependencies</name>
  <files>package.json</files>
  <action>
    Install required packages:

    npm install cli-highlight chalk

    For clipboardy (ESM-only in v5+), we need to handle import carefully.
    Since project uses "type": "commonjs", we'll use dynamic import.

    npm install clipboardy

    Note: clipboardy v5+ is ESM-only. The output.ts will use dynamic import().

    Verify all packages installed:
    - cli-highlight (syntax highlighting)
    - chalk (terminal colors)
    - clipboardy (clipboard operations)
  </action>
  <verify>
    - npm ls cli-highlight chalk clipboardy (shows all installed)
    - package.json includes all three in dependencies
  </verify>
  <done>Output dependencies installed (cli-highlight, chalk, clipboardy)</done>
</task>

<task type="auto">
  <name>Task 2: Create output module with highlighting and clipboard</name>
  <files>.knowledge/generator/output.ts</files>
  <action>
    Create output.ts with:

    1. Imports:
       - highlight from 'cli-highlight'
       - chalk from 'chalk'
       - Framework type from '../schema/categories'

    2. LANGUAGE_MAP constant mapping Framework to highlight.js language:
       ```typescript
       const LANGUAGE_MAP: Record<Framework, string> = {
         react: 'typescript',
         vue: 'html',
         svelte: 'html',
         vanilla: 'css'
       };
       ```

    3. displayCode(code: string, framework: Framework): void
       - Get language from LANGUAGE_MAP
       - Print separator line using chalk.dim
       - Print highlighted code using highlight(code, { language })
       - Print closing separator

    4. copyToClipboard(text: string): Promise<boolean>
       - Use dynamic import: const clipboard = await import('clipboardy')
       - Try clipboard.default.write(text)
       - Return true on success
       - Catch errors, log warning with chalk.yellow
       - Return false on failure (graceful degradation)

    5. outputCode(code: string, framework: Framework): Promise<void>
       - Call displayCode() to show preview
       - Call copyToClipboard() to copy
       - If success: print chalk.green('✓ Copied to clipboard')
       - If failure: print chalk.yellow('⚠ Copy the code above manually')

    Include JSDoc for all exports.
    Make separator line 50 chars wide using '─'.repeat(50).
  </action>
  <verify>
    - npx tsc --noEmit .knowledge/generator/output.ts (no errors)
    - File exports displayCode, copyToClipboard, outputCode
  </verify>
  <done>Output module created with syntax highlighting, clipboard copy, and graceful error handling</done>
</task>

<task type="auto">
  <name>Task 3: Update generator index and test output</name>
  <files>.knowledge/generator/index.ts</files>
  <action>
    Update .knowledge/generator/index.ts:

    Re-export from output:
    - displayCode function
    - copyToClipboard function
    - outputCode function

    Create verification script:

    1. Test displayCode:
       - Call with sample React code
       - Verify terminal shows colored output (visual check)

    2. Test copyToClipboard:
       - Copy "test clipboard" string
       - Verify returns true
       - Manual paste check (print instruction)

    3. Test outputCode combined:
       - Call with sample code and 'react' framework
       - Verify both display and copy work

    4. Test clipboard failure:
       - Mock clipboard.write to throw
       - Verify graceful fallback message appears

    Run with: npx tsx [script]
  </action>
  <verify>
    - npx tsc --noEmit .knowledge/generator/index.ts
    - Import { outputCode, displayCode, copyToClipboard } works
    - Visual verification of colored terminal output
  </verify>
  <done>Output functions exported and verified working with highlighting and clipboard</done>
</task>

</tasks>

<verification>
- npx tsc --noEmit .knowledge/generator/*.ts (all compile)
- displayCode shows colored syntax highlighting in terminal
- copyToClipboard successfully copies (can paste in another app)
- outputCode combines display + copy with success/failure messages
- Clipboard errors don't crash the program
</verification>

<success_criteria>
- Syntax highlighting visible in terminal for all framework types
- Clipboard copy works cross-platform (macOS, Linux, Windows)
- Clear confirmation message after clipboard copy
- Graceful fallback when clipboard unavailable
- Framework-appropriate language highlighting (TypeScript for React, HTML for Vue/Svelte, CSS for vanilla)
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-generation-engine/02-04-SUMMARY.md`
</output>
