---
phase: 02-code-generation-engine
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .knowledge/generator/framework-detector.ts
  - .knowledge/generator/index.ts
autonomous: true

must_haves:
  truths:
    - "detectFramework() returns 'react' for projects with react in package.json"
    - "detectFramework() returns 'vue' for projects with vue in package.json"
    - "detectFramework() returns 'svelte' for projects with svelte in package.json"
    - "detectFramework() returns 'vanilla' when no framework detected"
  artifacts:
    - path: ".knowledge/generator/framework-detector.ts"
      provides: "Framework detection from package.json"
      exports: ["detectFramework", "FRAMEWORK_PACKAGES"]
    - path: ".knowledge/generator/index.ts"
      provides: "Generator module public API"
      exports: ["detectFramework"]
  key_links:
    - from: ".knowledge/generator/framework-detector.ts"
      to: "../schema/categories"
      via: "import Framework type"
      pattern: "import.*Framework.*categories"
---

<objective>
Create framework detection module that analyzes package.json to identify React, Vue, Svelte, or vanilla projects.

Purpose: GEN-02 and GEN-09 require automatic framework detection. This enables `:generate` to output code in the correct framework syntax without user specification.
Output: framework-detector.ts that exports detectFramework() function returning Framework type.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-code-generation-engine/02-RESEARCH.md
@.knowledge/schema/categories.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create generator directory and framework detector</name>
  <files>.knowledge/generator/framework-detector.ts</files>
  <action>
    Create .knowledge/generator/ directory.

    Create framework-detector.ts with:

    1. Import Framework type from ../schema/categories

    2. Define FRAMEWORK_PACKAGES constant mapping Framework to package names:
       - react: ['react', 'react-dom', 'next', '@remix-run/react', 'gatsby']
       - vue: ['vue', 'nuxt', '@vue/cli-service', 'vite-plugin-vue']
       - svelte: ['svelte', '@sveltejs/kit', '@sveltejs/adapter-auto']
       - vanilla: [] (empty - fallback)

    3. Create detectFramework(projectDir?: string): Promise<Framework>
       - Default projectDir to '.' (current directory)
       - Read package.json from projectDir
       - Parse JSON, combine dependencies and devDependencies
       - Check each framework's packages in priority order (react first, then vue, then svelte)
       - Return first match, or 'vanilla' if none
       - Handle errors gracefully (missing file, parse error) -> return 'vanilla'

    Use async/await with fs/promises for file reading.
    Include JSDoc comments documenting the function.
  </action>
  <verify>
    - npx tsc --noEmit .knowledge/generator/framework-detector.ts (no TypeScript errors)
    - File exports detectFramework and FRAMEWORK_PACKAGES
  </verify>
  <done>Framework detector created with detection for React, Vue, Svelte, and vanilla fallback</done>
</task>

<task type="auto">
  <name>Task 2: Create generator module index</name>
  <files>.knowledge/generator/index.ts</files>
  <action>
    Create .knowledge/generator/index.ts as the public API for the generator module.

    Re-export from framework-detector:
    - detectFramework function
    - FRAMEWORK_PACKAGES constant

    Add module documentation comment explaining this is the code generation module that will be expanded with template compilation and output formatting.

    Pattern after .knowledge/lib/index.ts structure.
  </action>
  <verify>
    - npx tsc --noEmit .knowledge/generator/index.ts (no errors)
    - Import { detectFramework } from '.knowledge/generator' works
  </verify>
  <done>Generator module index created with framework detection exports</done>
</task>

<task type="auto">
  <name>Task 3: Test framework detection with sample package.json</name>
  <files>None (verification only)</files>
  <action>
    Create a quick verification script to test detectFramework():

    1. Create temp directory with React package.json -> verify returns 'react'
    2. Create temp directory with Vue package.json -> verify returns 'vue'
    3. Create temp directory with Svelte package.json -> verify returns 'svelte'
    4. Create temp directory with no framework -> verify returns 'vanilla'
    5. Test with non-existent directory -> verify returns 'vanilla' (graceful error)

    Run with: npx tsx [script]

    Clean up temp directories after test.

    Log results to console showing all tests pass.
  </action>
  <verify>
    - All 5 test cases log as passing
    - No temp directories left behind
  </verify>
  <done>Framework detection verified working for all framework types and edge cases</done>
</task>

</tasks>

<verification>
- npx tsc --noEmit .knowledge/generator/*.ts (all files compile)
- Framework detection returns correct framework for each type
- Error handling works for missing/invalid package.json
</verification>

<success_criteria>
- detectFramework() correctly identifies React, Vue, Svelte projects
- detectFramework() returns 'vanilla' as fallback
- detectFramework() handles missing package.json gracefully
- Module exports are accessible from .knowledge/generator
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-generation-engine/02-01-SUMMARY.md`
</output>
