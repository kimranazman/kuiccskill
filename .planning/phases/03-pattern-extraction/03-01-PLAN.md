---
phase: 03-pattern-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .knowledge/extractor/browser.ts
  - .knowledge/extractor/index.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Playwright browser launches and renders target URL"
    - "Page HTML content is captured after JavaScript execution"
    - "Computed CSS styles are extracted for all elements"
    - "All stylesheet content is captured including external files"
  artifacts:
    - path: ".knowledge/extractor/browser.ts"
      provides: "Browser automation and page fetching"
      exports: ["fetchPage", "extractComputedStyles", "extractStylesheets"]
    - path: ".knowledge/extractor/index.ts"
      provides: "Module exports"
      exports: ["fetchPage", "extractComputedStyles", "extractStylesheets"]
  key_links:
    - from: ".knowledge/extractor/browser.ts"
      to: "playwright"
      via: "chromium.launch"
      pattern: "chromium\\.launch"
---

<objective>
Set up browser automation foundation for pattern extraction.

Purpose: Enable fetching and rendering of target websites to capture fully-rendered HTML, computed CSS styles, and stylesheet content.
Output: Browser module that can launch Playwright, navigate to URL, wait for network idle, and extract page data.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pattern-extraction/03-RESEARCH.md
@.knowledge/lib/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and create browser module</name>
  <files>package.json, .knowledge/extractor/browser.ts</files>
  <action>
Install Playwright as a dependency:
```bash
npm install playwright
```

Create `.knowledge/extractor/browser.ts` with:

1. `fetchPage(url: string)` function:
   - Launch chromium browser (headless: true)
   - Create new page with reasonable viewport (1920x1080)
   - Navigate to URL with `waitUntil: 'networkidle'`
   - Return page instance for further processing
   - Include error handling for invalid URLs, timeouts

2. `extractComputedStyles(page: Page)` function:
   - Use page.evaluate to run getComputedStyle on elements
   - Target significant elements (divs, sections, buttons, forms, nav, etc.)
   - Extract layout properties: display, position, grid-template, flexbox properties
   - Extract animation properties: transition, animation, transform
   - Extract visual properties: background, border, box-shadow, opacity
   - Return typed array of element styles with selector paths

3. `extractStylesheets(page: Page)` function:
   - Access document.styleSheets via page.evaluate
   - Handle CORS by catching cross-origin stylesheet errors
   - Intercept network requests to capture external CSS files
   - Return array of stylesheet content strings

4. Type definitions for return values (ElementStyles, StylesheetData)
  </action>
  <verify>
Run TypeScript compiler: `npx tsc --noEmit .knowledge/extractor/browser.ts`
No type errors.
  </verify>
  <done>Browser module exists with fetchPage, extractComputedStyles, extractStylesheets functions that compile without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create module index and test extraction</name>
  <files>.knowledge/extractor/index.ts</files>
  <action>
Create `.knowledge/extractor/index.ts` that re-exports browser functions:
```typescript
export { fetchPage, extractComputedStyles, extractStylesheets } from './browser';
export type { ElementStyles, StylesheetData } from './browser';
```

Test the extraction works by creating a simple validation script that:
1. Calls fetchPage with a known URL (e.g., example.com)
2. Calls extractComputedStyles
3. Calls extractStylesheets
4. Logs summary of extracted data (element count, stylesheet count, total CSS size)
5. Closes browser

Run the validation to confirm browser automation works end-to-end.
  </action>
  <verify>
Run: `npx tsx .knowledge/extractor/browser.ts` (if test function added)
Or import and call in a temp script. Browser should launch, fetch page, extract data, close cleanly.
  </verify>
  <done>Extractor module exports work, browser launches and extracts data from a live URL without errors</done>
</task>

</tasks>

<verification>
1. Playwright installed in package.json dependencies
2. `.knowledge/extractor/browser.ts` exists with all three functions
3. `.knowledge/extractor/index.ts` exports the functions
4. TypeScript compiles without errors
5. Test extraction runs successfully against a real URL
</verification>

<success_criteria>
- Playwright dependency added to package.json
- Browser module can launch Chromium and navigate to URLs
- Computed styles extraction returns structured element data
- Stylesheet extraction captures CSS content
- Module compiles and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-pattern-extraction/03-01-SUMMARY.md`
</output>
