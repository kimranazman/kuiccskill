---
phase: 03-pattern-extraction
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .knowledge/extractor/dom-analyzer.ts
autonomous: true

must_haves:
  truths:
    - "HTML structure is parsed into component hierarchy"
    - "Layout containers are identified (header, nav, main, footer, sections)"
    - "Interactive elements are catalogued (buttons, forms, links)"
    - "Component boundaries are detected based on semantic HTML and class patterns"
  artifacts:
    - path: ".knowledge/extractor/dom-analyzer.ts"
      provides: "DOM structure analysis"
      exports: ["analyzeDomStructure", "identifyComponents", "extractHierarchy"]
  key_links:
    - from: ".knowledge/extractor/dom-analyzer.ts"
      to: "cheerio"
      via: "cheerio.load"
      pattern: "cheerio\\.load|\\$\\("
---

<objective>
Create DOM analysis module for extracting structural patterns from HTML.

Purpose: Parse HTML and identify meaningful component structures, layout hierarchies, and semantic patterns.
Output: DOM analyzer that produces component trees and structural metadata from raw HTML.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pattern-extraction/03-RESEARCH.md
@.knowledge/schema/categories.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DOM analyzer module</name>
  <files>.knowledge/extractor/dom-analyzer.ts</files>
  <action>
Note: Cheerio is already installed from Phase 1-2 (check package.json).

Create `.knowledge/extractor/dom-analyzer.ts` with:

1. Type definitions:
```typescript
interface DomComponent {
  type: 'layout' | 'navigation' | 'form' | 'interactive' | 'content' | 'feedback';
  tag: string;
  selector: string;
  classes: string[];
  attributes: Record<string, string>;
  children: DomComponent[];
  depth: number;
}

interface StructureAnalysis {
  hasHeader: boolean;
  hasNav: boolean;
  hasMain: boolean;
  hasFooter: boolean;
  hasSidebar: boolean;
  formCount: number;
  buttonCount: number;
  linkCount: number;
}

interface ComponentHierarchy {
  root: DomComponent;
  components: DomComponent[];
  structure: StructureAnalysis;
}
```

2. `analyzeDomStructure(html: string)` function:
   - Load HTML with cheerio
   - Detect presence of semantic elements (header, nav, main, aside, footer)
   - Count interactive elements (buttons, forms, links)
   - Return StructureAnalysis object

3. `identifyComponents(html: string)` function:
   - Walk DOM tree identifying component boundaries
   - Use heuristics: semantic tags, common class patterns (container, card, modal, form, nav)
   - Classify components by type (layout, navigation, form, etc.)
   - Return array of DomComponent objects with nesting

4. `extractHierarchy(html: string)` function:
   - Build complete component tree from root
   - Track depth for indentation/nesting analysis
   - Combine structure analysis with component list
   - Return ComponentHierarchy object

Helper functions:
- `classifyElement(tag: string, classes: string[])` - determine component type
- `buildSelector(element: cheerio.Element, $: cheerio.CheerioAPI)` - generate CSS selector path
  </action>
  <verify>
Run TypeScript compiler: `npx tsc --noEmit .knowledge/extractor/dom-analyzer.ts`
No type errors.
  </verify>
  <done>DOM analyzer module exists with analyzeDomStructure, identifyComponents, extractHierarchy functions</done>
</task>

<task type="auto">
  <name>Task 2: Test DOM analyzer with sample HTML</name>
  <files>.knowledge/extractor/dom-analyzer.ts</files>
  <action>
Add a test/validation function at the end of dom-analyzer.ts:

```typescript
// Validation - run with: npx tsx .knowledge/extractor/dom-analyzer.ts
if (require.main === module) {
  const testHtml = `
    <!DOCTYPE html>
    <html>
    <head><title>Test</title></head>
    <body>
      <header class="site-header">
        <nav class="main-nav">
          <a href="/">Home</a>
          <a href="/about">About</a>
        </nav>
      </header>
      <main>
        <section class="hero">
          <h1>Welcome</h1>
          <button class="cta-button">Get Started</button>
        </section>
        <section class="features">
          <div class="card">Feature 1</div>
          <div class="card">Feature 2</div>
        </section>
      </main>
      <footer>
        <form class="newsletter">
          <input type="email" placeholder="Email">
          <button type="submit">Subscribe</button>
        </form>
      </footer>
    </body>
    </html>
  `;

  console.log('Structure:', analyzeDomStructure(testHtml));
  console.log('Components:', identifyComponents(testHtml).map(c => ({
    type: c.type,
    tag: c.tag,
    classes: c.classes
  })));
}
```

Run the validation and verify:
- Structure shows header, nav, main, footer detected
- Components include navigation, layout (sections), form, interactive (buttons)
- Class names are captured correctly
  </action>
  <verify>
Run: `npx tsx .knowledge/extractor/dom-analyzer.ts`
Should output structure analysis and component list with correct classifications.
  </verify>
  <done>DOM analyzer correctly identifies page structure and components from sample HTML</done>
</task>

</tasks>

<verification>
1. `.knowledge/extractor/dom-analyzer.ts` exists with all three main functions
2. TypeScript compiles without errors
3. Structure analysis correctly detects semantic elements
4. Component identification classifies elements appropriately
5. Validation outputs match expected structure
</verification>

<success_criteria>
- Semantic HTML elements (header, nav, main, footer) are detected
- Form elements and buttons are counted and classified
- Component hierarchy reflects DOM nesting
- Class patterns (card, container, modal) help classify component types
- Returns structured data suitable for AI pattern analysis
</success_criteria>

<output>
After completion, create `.planning/phases/03-pattern-extraction/03-03-SUMMARY.md`
</output>
