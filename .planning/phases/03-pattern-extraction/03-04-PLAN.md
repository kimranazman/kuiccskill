---
phase: 03-pattern-extraction
plan: 04
type: execute
wave: 2
depends_on: [03-01, 03-02, 03-03]
files_modified:
  - .knowledge/extractor/pattern-identifier.ts
  - .knowledge/extractor/index.ts
autonomous: true

must_haves:
  truths:
    - "Extracted CSS/DOM data is combined into analysis context"
    - "AI prompt identifies meaningful patterns from raw data"
    - "Generated patterns conform to existing PatternSchema"
    - "Patterns are validated before being returned"
  artifacts:
    - path: ".knowledge/extractor/pattern-identifier.ts"
      provides: "AI-powered pattern identification"
      exports: ["identifyPatterns", "buildAnalysisContext", "generatePatternYaml"]
  key_links:
    - from: ".knowledge/extractor/pattern-identifier.ts"
      to: ".knowledge/schema/pattern.schema.ts"
      via: "PatternSchema validation"
      pattern: "PatternSchema\\.parse"
---

<objective>
Create AI-powered pattern identification module that analyzes extracted data and generates valid pattern YAML.

Purpose: Transform raw CSS/DOM extraction data into meaningful, validated design patterns using AI analysis.
Output: Pattern identifier that produces valid Pattern objects from extraction results.
</objective>

<execution_context>
@/Users/khairul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/khairul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pattern-extraction/03-RESEARCH.md
@.knowledge/schema/pattern.schema.ts
@.knowledge/schema/categories.ts
@.knowledge/patterns/micro-interactions/button-hover-effect.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pattern identifier module</name>
  <files>.knowledge/extractor/pattern-identifier.ts</files>
  <action>
Create `.knowledge/extractor/pattern-identifier.ts` with:

1. Import types from other extractor modules and schema:
```typescript
import { PatternSchema, type Pattern } from '../schema/pattern.schema';
import { CATEGORIES, type Category } from '../schema/categories';
import type { AnimationPattern, LayoutPattern, InteractionPattern } from './css-analyzer';
import type { ComponentHierarchy, DomComponent } from './dom-analyzer';
import type { ElementStyles, StylesheetData } from './browser';
```

2. `ExtractionData` type combining all extraction results:
```typescript
interface ExtractionData {
  url: string;
  timestamp: string;
  styles: ElementStyles[];
  stylesheets: StylesheetData[];
  animations: AnimationPattern[];
  layouts: LayoutPattern[];
  interactions: InteractionPattern[];
  domHierarchy: ComponentHierarchy;
}
```

3. `buildAnalysisContext(data: ExtractionData)` function:
   - Summarize extraction data into concise text format
   - Group by pattern category (animations, layouts, micro-interactions)
   - Include relevant CSS snippets and selectors
   - Return string suitable for AI prompt context

4. `buildPatternPrompt(context: string, category: Category)` function:
   - Create prompt asking AI to identify patterns in the category
   - Include PatternSchema structure requirements
   - Request output in YAML format matching schema
   - Include example of existing pattern for reference format

5. `parsePatternResponse(response: string)` function:
   - Extract YAML from AI response (handle code blocks)
   - Parse YAML to object
   - Return parsed object or null if parsing fails

6. `identifyPatterns(data: ExtractionData)` function:
   - Build analysis context from extraction data
   - For each relevant category, build prompt and analyze
   - Parse responses into pattern objects
   - Validate each pattern against PatternSchema
   - Return array of valid Pattern objects

7. `generatePatternYaml(pattern: Pattern)` function:
   - Convert validated Pattern to YAML string
   - Use yaml.stringify for consistent formatting
   - Return YAML string ready for file writing

Note: The actual AI invocation will happen through Claude's context when this module is used in the skill. The functions prepare prompts and parse responses.
  </action>
  <verify>
Run TypeScript compiler: `npx tsc --noEmit .knowledge/extractor/pattern-identifier.ts`
No type errors. All imports resolve correctly.
  </verify>
  <done>Pattern identifier module exists with buildAnalysisContext, identifyPatterns, generatePatternYaml functions</done>
</task>

<task type="auto">
  <name>Task 2: Update extractor index and add pattern identification types</name>
  <files>.knowledge/extractor/index.ts</files>
  <action>
Update `.knowledge/extractor/index.ts` to export all extractor modules:

```typescript
// Browser automation
export { fetchPage, extractComputedStyles, extractStylesheets } from './browser';
export type { ElementStyles, StylesheetData } from './browser';

// CSS analysis
export { parseCss, extractAnimations, extractLayoutPatterns, extractInteractions } from './css-analyzer';
export type { AnimationPattern, LayoutPattern, InteractionPattern } from './css-analyzer';

// DOM analysis
export { analyzeDomStructure, identifyComponents, extractHierarchy } from './dom-analyzer';
export type { DomComponent, StructureAnalysis, ComponentHierarchy } from './dom-analyzer';

// Pattern identification
export { buildAnalysisContext, identifyPatterns, generatePatternYaml } from './pattern-identifier';
export type { ExtractionData } from './pattern-identifier';
```

Verify all exports are accessible:
```typescript
// Test import - should compile without errors
import {
  fetchPage,
  parseCss,
  analyzeDomStructure,
  identifyPatterns
} from '.knowledge/extractor';
```
  </action>
  <verify>
Create a test file that imports from the index and verify TypeScript compiles without errors.
  </verify>
  <done>Extractor index re-exports all modules, imports work correctly</done>
</task>

</tasks>

<verification>
1. `.knowledge/extractor/pattern-identifier.ts` exists with all functions
2. ExtractionData type combines all extraction module types
3. buildAnalysisContext produces readable summary of extracted data
4. Pattern validation uses existing PatternSchema
5. Module index exports everything needed for skill integration
</verification>

<success_criteria>
- Extraction data from browser, CSS, and DOM modules can be combined
- Analysis context is formatted for AI interpretation
- Pattern prompts reference correct schema structure
- Validated patterns conform to PatternSchema
- YAML generation produces valid, parseable output
</success_criteria>

<output>
After completion, create `.planning/phases/03-pattern-extraction/03-04-SUMMARY.md`
</output>
